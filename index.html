<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cadastro Local AvanÃ§ado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ======= ESTILO GERAL ======= */
    :root {
      --cor-principal: #4f8cff;
      --cor-secundaria: #00c9a7;
      --cor-fundo: #f4f7fb;
      --cor-texto: #333;
      --borda: 8px;
      --sombra: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    body {
      font-family: "Poppins", Arial, sans-serif;
      background: var(--cor-fundo);
      color: var(--cor-texto);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background: white;
      width: 95%;
      max-width: 850px;
      margin: 30px auto;
      border-radius: var(--borda);
      box-shadow: var(--sombra);
      padding: 25px;
      transition: all 0.3s ease;
      animation: aparecer 0.6s ease;
    }

    @keyframes aparecer {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h2 {
      text-align: center;
      color: var(--cor-principal);
      margin-bottom: 20px;
    }

    input, button {
      padding: 10px;
      margin: 6px;
      border-radius: var(--borda);
      border: 1px solid #ccc;
      font-size: 14px;
      width: calc(100% - 20px);
      box-sizing: border-box;
      transition: all 0.2s ease;
    }

    input:focus {
      border-color: var(--cor-principal);
      outline: none;
      box-shadow: 0 0 5px var(--cor-principal);
    }

    button {
      background: linear-gradient(45deg, var(--cor-principal), var(--cor-secundaria));
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
      transition: transform 0.2s, opacity 0.2s;
    }

    button:hover {
      opacity: 0.9;
      transform: scale(1.03);
    }

    #login, #registro, #cadastro { display: none; }

    /* ======= SEÃ‡ÃƒO DE CADASTRO ======= */
    .botoes-acoes {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: var(--borda);
      overflow: hidden;
      box-shadow: var(--sombra);
      margin-top: 10px;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #eee;
      text-align: left;
      font-size: 14px;
    }

    th {
      background: var(--cor-principal);
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    tr:hover {
      background: #f9f9f9;
    }

    td input {
      width: 100%;
      border: none;
      background: transparent;
      border-bottom: 1px solid #ddd;
      padding: 5px;
    }

    td input:focus {
      border-color: var(--cor-secundaria);
      outline: none;
    }

    .acoes button {
      margin: 2px;
      padding: 6px 10px;
      border-radius: 5px;
      border: none;
      color: white;
      font-weight: 500;
      cursor: pointer;
    }

    .alterar { background: #2196F3; }
    .apagar { background: #f44336; }
    .pdf { background: #9C27B0; }

    /* ======= MOBILE: TABELA EM CARDS ======= */
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }

      th { display: none; }

      tr {
        background: white;
        margin-bottom: 12px;
        border-radius: var(--borda);
        box-shadow: var(--sombra);
        padding: 10px;
      }

      td {
        display: flex;
        justify-content: space-between;
        padding: 8px 5px;
        border: none;
        border-bottom: 1px solid #eee;
      }

      td::before {
        content: attr(data-label);
        font-weight: bold;
        color: var(--cor-principal);
      }
    }

  </style>
</head>
<body>

  <div class="container" id="login">
    <h2>Entrar</h2>
    <input id="loginEmail" placeholder="Email">
    <input id="loginSenha" type="password" placeholder="Senha">
    <button onclick="entrar()">Entrar</button>
    <button onclick="mostrarRegistro()">Criar conta</button>
  </div>

  <div class="container" id="registro">
    <h2>Registrar</h2>
    <input id="regEmail" placeholder="Email">
    <input id="regSenha" type="password" placeholder="Senha">
    <button onclick="registrar()">Salvar Registro</button>
    <button onclick="mostrarLogin()">Voltar</button>
  </div>

  <div class="container" id="cadastro">
    <h2>Cadastro Local AvanÃ§ado</h2>

    <div class="botoes-acoes">
      <input id="nome" placeholder="Nome">
      <input id="sobrenome" placeholder="Sobrenome">
      <input id="email" placeholder="Email">
      <input id="busca" placeholder="ðŸ” Buscar..." oninput="mostrar()">
      <button onclick="salvar()">ðŸ’¾ Salvar</button>
      <button onclick="exportarTXT()">TXT</button>
      <button onclick="exportarExcel()">Excel</button>
      <button onclick="exportarPDF()">PDF</button>
      <button onclick="sair()">ðŸšª Sair</button>
    </div>

    <table id="tabela">
      <thead>
        <tr>
          <th>UUID</th>
          <th>Nome</th>
          <th>Sobrenome</th>
          <th>Email</th>
          <th>AÃ§Ãµes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    let usuarioAtual = null;
    mostrarLogin();

    function mostrarLogin() {
      document.getElementById("login").style.display = "block";
      document.getElementById("registro").style.display = "none";
      document.getElementById("cadastro").style.display = "none";
    }

    function mostrarRegistro() {
      document.getElementById("login").style.display = "none";
      document.getElementById("registro").style.display = "block";
      document.getElementById("cadastro").style.display = "none";
    }

    function registrar() {
      const email = regEmail.value.trim();
      const senha = regSenha.value.trim();
      if (!email || !senha) return alert("Preencha tudo!");
      const contas = JSON.parse(localStorage.getItem("contas")) || [];
      if (contas.find(c => c.email === email)) return alert("Email jÃ¡ registrado!");
      contas.push({ email, senha });
      localStorage.setItem("contas", JSON.stringify(contas));
      alert("Conta criada!");
      mostrarLogin();
    }

    function entrar() {
      const email = loginEmail.value.trim();
      const senha = loginSenha.value.trim();
      const contas = JSON.parse(localStorage.getItem("contas")) || [];
      const conta = contas.find(c => c.email === email && c.senha === senha);
      if (!conta) return alert("Credenciais invÃ¡lidas!");
      usuarioAtual = email;
      document.getElementById("login").style.display = "none";
      document.getElementById("registro").style.display = "none";
      document.getElementById("cadastro").style.display = "block";
      mostrar();
    }

    function sair() {
      usuarioAtual = null;
      mostrarLogin();
    }

    function gerarUUID() {
      return 'xxxx-4xxx-yxxx-xxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function salvar() {
      const nome = nomeInput.value.trim();
      const sobrenome = sobrenomeInput.value.trim();
      const email = emailInput.value.trim();
      if (!nome || !sobrenome || !email) return alert("Preencha tudo!");
      const lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      lista.push({ uuid: gerarUUID(), nome, sobrenome, email });
      localStorage.setItem(usuarioAtual, JSON.stringify(lista));
      mostrar();
      nomeInput.value = sobrenomeInput.value = emailInput.value = "";
    }

    function mostrar() {
      const filtro = busca.value.toLowerCase();
      const lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      const tbody = document.querySelector("#tabela tbody");
      tbody.innerHTML = "";
      lista
        .filter(u =>
          u.uuid.toLowerCase().includes(filtro) ||
          u.nome.toLowerCase().includes(filtro) ||
          u.sobrenome.toLowerCase().includes(filtro) ||
          u.email.toLowerCase().includes(filtro)
        )
        .forEach(u => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td data-label="UUID">${u.uuid}</td>
            <td data-label="Nome"><input value="${u.nome}" onchange="editar('${u.uuid}', 'nome', this.value)"></td>
            <td data-label="Sobrenome"><input value="${u.sobrenome}" onchange="editar('${u.uuid}', 'sobrenome', this.value)"></td>
            <td data-label="Email"><input value="${u.email}" onchange="editar('${u.uuid}', 'email', this.value)"></td>
            <td data-label="AÃ§Ãµes" class="acoes">
              <button class="alterar" onclick="alert('Atualizado!')">Salvar</button>
              <button class="apagar" onclick="apagar('${u.uuid}')">Apagar</button>
              <button class="pdf" onclick="exportarPDF('${u.uuid}')">PDF</button>
            </td>`;
          tbody.appendChild(tr);
        });
    }

    function editar(uuid, campo, valor) {
      const lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      const item = lista.find(u => u.uuid === uuid);
      if (item) {
        item[campo] = valor;
        localStorage.setItem(usuarioAtual, JSON.stringify(lista));
      }
    }

    function apagar(uuid) {
      if (!confirm("Apagar este registro?")) return;
      let lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      lista = lista.filter(u => u.uuid !== uuid);
      localStorage.setItem(usuarioAtual, JSON.stringify(lista));
      mostrar();
    }

    function exportarTXT() {
      const lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      if (!lista.length) return alert("Sem dados!");
      const conteudo = lista.map(u => `${u.uuid}\t${u.nome}\t${u.sobrenome}\t${u.email}`).join("\n");
      const blob = new Blob([conteudo], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "usuarios.txt";
      a.click();
    }

    function exportarExcel() {
      const lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      if (!lista.length) return alert("Sem dados!");
      const conteudo = "UUID,Nome,Sobrenome,Email\n" + lista.map(u => `"${u.uuid}","${u.nome}","${u.sobrenome}","${u.email}"`).join("\n");
      const blob = new Blob([conteudo], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "usuarios.csv";
      a.click();
    }

    async function exportarPDF(uuid = null) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const lista = JSON.parse(localStorage.getItem(usuarioAtual)) || [];
      let dados = uuid ? lista.filter(u => u.uuid === uuid) : lista;
      doc.setFontSize(14);
      doc.text("RelatÃ³rio de UsuÃ¡rios", 70, 15);
      let y = 30;
      dados.forEach(u => {
        doc.text(`UUID: ${u.uuid}`, 10, y);
        doc.text(`Nome: ${u.nome}`, 10, y + 8);
        doc.text(`Sobrenome: ${u.sobrenome}`, 10, y + 16);
        doc.text(`Email: ${u.email}`, 10, y + 24);
        y += 35;
      });
      doc.save(uuid ? `usuario_${uuid}.pdf` : "usuarios.pdf");
    }
  </script>

</body>
</html>