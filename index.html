<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro Local Avan√ßado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-green { background: #4CAF50; }
    .btn-gray { background: #555; }
    .btn-red { background: #e74c3c; }
    .btn-blue { background: #3498db; }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      margin-top: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background: #4CAF50;
      color: white;
    }

    tr:nth-child(even) { background: #f9f9f9; }

    td input {
      width: 95%;
      padding: 5px;
    }

    td button {
      width: auto;
      margin: 2px;
      padding: 6px 10px;
      border-radius: 4px;
    }

    #busca {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    /* ====== Modo celular ====== */
    @media (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      tr {
        background: #fff;
        margin: 10px 0;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      }
      td {
        border: none;
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
      }
      th { display: none; }
    }
  </style>
</head>
<body>
  <!-- REGISTRO -->
  <div class="container" id="registroDiv">
    <h2>Registrar</h2>
    <input id="regNome" placeholder="Nome completo" />
    <input id="regEmail" placeholder="E-mail" type="email" />
    <input id="regSenha" placeholder="Senha (m√≠n. 4)" type="password" />
    <input id="regConf" placeholder="Confirmar senha" type="password" />
    <button class="btn-green" onclick="registrar()">Criar conta</button>
    <button class="btn-gray" onclick="mostrarLogin()">J√° tenho conta</button>
  </div>

  <!-- LOGIN -->
  <div class="container" id="loginDiv" style="display:none">
    <h2>Entrar</h2>
    <input id="logEmail" placeholder="E-mail" type="email" />
    <input id="logSenha" placeholder="Senha" type="password" />
    <button class="btn-green" onclick="login()">Entrar</button>
    <button class="btn-gray" onclick="mostrarRegistro()">Ainda n√£o tenho conta</button>
  </div>

  <!-- CADASTRO LOCAL -->
  <div class="container" id="cadastroDiv" style="display:none">
    <h2>Cadastro Local Avan√ßado</h2>
    <p><b id="usuarioAtual"></b> <button class="btn-red" onclick="sair()">Sair</button></p>

    <input id="nome" placeholder="Nome" />
    <input id="sobrenome" placeholder="Sobrenome" />
    <input id="email" placeholder="Email" />
    <button class="btn-green" onclick="salvar()">üíæ Salvar</button>
    <button class="btn-red" onclick="apagarTudo()">üóëÔ∏è Apagar todos</button>
    <button class="btn-blue" onclick="exportarTXT()">üìÑ Exportar TXT</button>
    <button class="btn-blue" onclick="exportarExcel()">üìä Exportar Excel</button>

    <input id="busca" placeholder="üîç Buscar por nome, sobrenome ou email" oninput="buscar()"/>

    <table id="tabela">
      <thead>
        <tr>
          <th>UUID</th>
          <th>Nome</th>
          <th>Sobrenome</th>
          <th>Email</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    let usuarioLogado = null;

    function mostrarLogin() {
      registroDiv.style.display = "none";
      loginDiv.style.display = "block";
    }

    function mostrarRegistro() {
      registroDiv.style.display = "block";
      loginDiv.style.display = "none";
    }

    function registrar() {
      const nome = regNome.value.trim();
      const email = regEmail.value.trim();
      const senha = regSenha.value;
      const conf = regConf.value;

      if (!nome || !email || !senha) return alert("Preencha todos os campos!");
      if (senha.length < 4) return alert("Senha deve ter pelo menos 4 caracteres!");
      if (senha !== conf) return alert("As senhas n√£o coincidem!");

      let usuarios = JSON.parse(localStorage.getItem("contas")) || [];
      if (usuarios.find(u => u.email === email)) return alert("E-mail j√° cadastrado!");

      usuarios.push({ nome, email, senha });
      localStorage.setItem("contas", JSON.stringify(usuarios));
      alert("Conta criada com sucesso!");
      mostrarLogin();
    }

    function login() {
      const email = logEmail.value.trim();
      const senha = logSenha.value;
      const usuarios = JSON.parse(localStorage.getItem("contas")) || [];
      const user = usuarios.find(u => u.email === email && u.senha === senha);
      if (!user) return alert("E-mail ou senha incorretos!");

      usuarioLogado = user;
      localStorage.setItem("usuarioAtual", JSON.stringify(user));
      mostrarCadastro();
    }

    function mostrarCadastro() {
      registroDiv.style.display = "none";
      loginDiv.style.display = "none";
      cadastroDiv.style.display = "block";
      usuarioAtual.textContent = `${usuarioLogado.nome} (${usuarioLogado.email})`;
      mostrar();
    }

    function sair() {
      localStorage.removeItem("usuarioAtual");
      usuarioLogado = null;
      mostrarLogin();
    }

    function gerarUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function salvar() {
      const nome = document.getElementById("nome").value.trim();
      const sobrenome = document.getElementById("sobrenome").value.trim();
      const email = document.getElementById("email").value.trim();
      if (!nome || !sobrenome || !email) return alert("Preencha todos os campos!");

      const uuid = gerarUUID();
      const dados = { uuid, nome, sobrenome, email, user: usuarioLogado.email };

      let lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      lista.push(dados);
      localStorage.setItem("usuarios", JSON.stringify(lista));
      mostrar();

      nome.value = sobrenome.value = email.value = "";
    }

    function mostrar(filtro = "") {
      const lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      const tbody = document.querySelector("#tabela tbody");
      tbody.innerHTML = "";

      lista
        .filter(i => i.user === usuarioLogado.email &&
          (i.nome.toLowerCase().includes(filtro) ||
           i.sobrenome.toLowerCase().includes(filtro) ||
           i.email.toLowerCase().includes(filtro)))
        .forEach(item => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td data-label="UUID">${item.uuid}</td>
            <td data-label="Nome"><input value="${item.nome}" onchange="atualizarCampo('${item.uuid}','nome',this.value)"></td>
            <td data-label="Sobrenome"><input value="${item.sobrenome}" onchange="atualizarCampo('${item.uuid}','sobrenome',this.value)"></td>
            <td data-label="Email"><input value="${item.email}" onchange="atualizarCampo('${item.uuid}','email',this.value)"></td>
            <td data-label="A√ß√µes">
              <button class='btn-green' onclick="atualizarRegistro('${item.uuid}')">Salvar</button>
              <button class='btn-red' onclick="apagar('${item.uuid}')">Apagar</button>
            </td>`;
          tbody.appendChild(tr);
        });
    }

    function buscar() {
      const termo = document.getElementById("busca").value.toLowerCase();
      mostrar(termo);
    }

    function atualizarCampo(uuid, campo, valor) {
      let lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      const item = lista.find(u => u.uuid === uuid);
      if (!item) return;
      item[campo] = valor;
      localStorage.setItem("usuarios", JSON.stringify(lista));
    }

    function atualizarRegistro(uuid) {
      alert("Registro atualizado!");
    }

    function apagar(uuid) {
      if (!confirm("Apagar este registro?")) return;
      let lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      lista = lista.filter(item => item.uuid !== uuid);
      localStorage.setItem("usuarios", JSON.stringify(lista));
      mostrar();
    }

    function apagarTudo() {
      if (!confirm("Apagar todos os registros?")) return;
      let lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      lista = lista.filter(i => i.user !== usuarioLogado.email);
      localStorage.setItem("usuarios", JSON.stringify(lista));
      mostrar();
    }

    function exportarTXT() {
      const lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      const userList = lista.filter(u => u.user === usuarioLogado.email);
      if (userList.length === 0) return alert("Nada para exportar.");

      let conteudo = "UUID\tNome\tSobrenome\tEmail\n";
      userList.forEach(u => conteudo += `${u.uuid}\t${u.nome}\t${u.sobrenome}\t${u.email}\n`);

      const blob = new Blob([conteudo], { type: "text/plain" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "usuarios.txt";
      a.click();
      URL.revokeObjectURL(url);
    }

    function exportarExcel() {
      const lista = JSON.parse(localStorage.getItem("usuarios")) || [];
      const userList = lista.filter(u => u.user === usuarioLogado.email);
      if (userList.length === 0) return alert("Nada para exportar.");

      let conteudo = "UUID,Nome,Sobrenome,Email\n";
      userList.forEach(u => conteudo += `"${u.uuid}","${u.nome}","${u.sobrenome}","${u.email}"\n`);

      const blob = new Blob([conteudo], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "usuarios.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    // Verifica login salvo
    const savedUser = localStorage.getItem("usuarioAtual");
    if (savedUser) {
      usuarioLogado = JSON.parse(savedUser);
      mostrarCadastro();
    }
  </script>
</body>
</html>