<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Local - Login + Cadastro Avan√ßado + PDF</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    h2 { text-align: center; margin-top: 20px; }

    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    input {
      padding: 8px;
      margin: 6px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px;
      width: 100%;
      margin: 6px 0;
      border: none;
      border-radius: 4px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #45a049; }

    .hidden { display: none; }

    .topbar {
      background: #4CAF50;
      color: white;
      padding: 10px;
      text-align: right;
    }
    .topbar button {
      background: #f44336;
      width: auto;
      padding: 6px 12px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th { background: #4CAF50; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    tr:hover { background: #ddd; }

    td input { width: 90%; padding: 4px; }

    td button {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }
    td button:first-child { background: #2196F3; }
    td button:nth-child(2) { background: #f44336; }
    td button:last-child { background: #9C27B0; } /* PDF Individual */

    @media (max-width: 720px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }

      tr {
        margin: 0 0 12px 0;
        padding: 10px;
        border-radius: 8px;
        background: #fff;
        box-shadow: 0 1px 6px rgba(0,0,0,0.04);
        border: 1px solid #e6e6e6;
      }

      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 6px;
        border: none;
        border-bottom: 1px solid #f0f0f0;
      }

      td:last-child { border-bottom: none; }

      td::before {
        content: attr(data-label);
        font-weight: 600;
        margin-right: 10px;
        flex: 0 0 40%;
        color: #555;
      }

      td input { width: 60%; }
      td:last-child { display: flex; gap: 8px; justify-content: flex-end; }
      .wrap input, .wrap button { width: 100%; display: block; margin: 6px 0; }
    }
  </style>
</head>
<body>

  <div class="container" id="loginRegistro">
    <h2 id="tituloForm">Registrar</h2>
    <input id="nome" placeholder="Nome completo" class="campo-registro">
    <input id="email" placeholder="Email">
    <input id="senha" placeholder="Senha" type="password">
    <button onclick="registrar()">Criar conta</button>
    <button onclick="mostrarLogin()">J√° tenho conta</button>
  </div>

  <div class="hidden" id="areaPrincipal">
    <div class="topbar">
      <span id="usuarioAtual"></span>
      <button onclick="sair()">Sair</button>
    </div>

    <div class="container wrap">
      <h2>Cadastro Local Avan√ßado</h2>
      <input id="cadNome" placeholder="Nome">
      <input id="cadSobrenome" placeholder="Sobrenome">
      <input id="cadEmail" placeholder="Email">
      <button onclick="salvar()">üíæ Salvar</button>
      <button onclick="apagarTudo()">üóëÔ∏è Apagar todos</button>
      <button onclick="exportarTXT()">üìÑ Exportar TXT</button>
      <button onclick="exportarExcel()">üìä Exportar Excel</button>
      <button onclick="exportarPDFGeral()">üìò Exportar Todos PDF</button>

      <table id="tabela">
        <thead>
          <tr>
            <th>UUID</th>
            <th>Nome</th>
            <th>Sobrenome</th>
            <th>Email</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const loginRegistro = document.getElementById("loginRegistro");
    const areaPrincipal = document.getElementById("areaPrincipal");

    function mostrarLogin() {
      document.getElementById("tituloForm").innerText = "Login";
      document.querySelector(".campo-registro").style.display = "none";
      document.querySelector("button[onclick='registrar()']").innerText = "Entrar";
      document.querySelector("button[onclick='registrar()']").setAttribute("onclick", "login()");
    }

    function mostrarRegistro() {
      document.getElementById("tituloForm").innerText = "Registrar";
      document.querySelector(".campo-registro").style.display = "block";
      document.querySelector("button[onclick='login()']").innerText = "Criar conta";
      document.querySelector("button[onclick='login()']").setAttribute("onclick", "registrar()");
    }

    function registrar() {
      const nome = nomeInput.value.trim();
      const email = emailInput.value.trim();
      const senha = senhaInput.value.trim();
      if (!nome || !email || !senha) return alert("Preencha todos os campos!");

      const usuarios = JSON.parse(localStorage.getItem("usuariosLogin")) || [];
      if (usuarios.find(u => u.email === email)) return alert("E-mail j√° registrado.");

      usuarios.push({ nome, email, senha });
      localStorage.setItem("usuariosLogin", JSON.stringify(usuarios));
      alert("Registrado com sucesso!");
      mostrarLogin();
    }

    function login() {
      const email = emailInput.value.trim();
      const senha = senhaInput.value.trim();
      const usuarios = JSON.parse(localStorage.getItem("usuariosLogin")) || [];
      const usuario = usuarios.find(u => u.email === email && u.senha === senha);
      if (!usuario) return alert("Credenciais inv√°lidas.");

      localStorage.setItem("usuarioLogado", JSON.stringify(usuario));
      mostrarSistema();
    }

    function sair() {
      localStorage.removeItem("usuarioLogado");
      areaPrincipal.classList.add("hidden");
      loginRegistro.classList.remove("hidden");
      mostrarLogin();
    }

    // ===== CADASTRO LOCAL =====
    function gerarUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function salvar() {
      const nome = cadNome.value.trim();
      const sobrenome = cadSobrenome.value.trim();
      const email = cadEmail.value.trim();
      if (!nome || !sobrenome || !email) return alert("Preencha todos os campos!");

      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      let lista = JSON.parse(localStorage.getItem(chave)) || [];
      lista.push({ uuid: gerarUUID(), nome, sobrenome, email });
      localStorage.setItem(chave, JSON.stringify(lista));
      mostrar();
      cadNome.value = cadSobrenome.value = cadEmail.value = "";
    }

    function mostrar() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      const lista = JSON.parse(localStorage.getItem(chave)) || [];
      const tbody = document.querySelector("#tabela tbody");
      tbody.innerHTML = "";

      lista.forEach(item => {
        const tr = document.createElement("tr");

        const tdUUID = criarCelula(item.uuid, "UUID");
        const tdNome = criarInputCelula(item, "nome", "Nome");
        const tdSob = criarInputCelula(item, "sobrenome", "Sobrenome");
        const tdEmail = criarInputCelula(item, "email", "Email");

        const tdAcoes = document.createElement("td");
        tdAcoes.setAttribute("data-label", "A√ß√µes");

        const btnAlt = criarBotao("Alterar", "#2196F3", () => alert("Atualizado!"));
        const btnDel = criarBotao("Apagar", "#f44336", () => apagar(item.uuid));
        const btnPDF = criarBotao("PDF", "#9C27B0", () => exportarPDFIndividual(item));

        tdAcoes.append(btnAlt, btnDel, btnPDF);
        tr.append(tdUUID, tdNome, tdSob, tdEmail, tdAcoes);
        tbody.appendChild(tr);
      });
    }

    function criarCelula(texto, label) {
      const td = document.createElement("td");
      td.textContent = texto;
      td.setAttribute("data-label", label);
      return td;
    }

    function criarInputCelula(item, campo, label) {
      const td = document.createElement("td");
      const input = document.createElement("input");
      input.value = item[campo];
      input.onchange = () => atualizarCampo(item.uuid, campo, input.value);
      td.appendChild(input);
      td.setAttribute("data-label", label);
      return td;
    }

    function criarBotao(texto, cor, acao) {
      const btn = document.createElement("button");
      btn.textContent = texto;
      btn.style.background = cor;
      btn.onclick = acao;
      return btn;
    }

    function atualizarCampo(uuid, campo, valor) {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      let lista = JSON.parse(localStorage.getItem(chave)) || [];
      const item = lista.find(u => u.uuid === uuid);
      if (item) item[campo] = valor;
      localStorage.setItem(chave, JSON.stringify(lista));
    }

    function apagar(uuid) {
      if (!confirm("Apagar este registro?")) return;
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      let lista = JSON.parse(localStorage.getItem(chave)) || [];
      lista = lista.filter(item => item.uuid !== uuid);
      localStorage.setItem(chave, JSON.stringify(lista));
      mostrar();
    }

    function apagarTudo() {
      if (!confirm("Apagar todos os registros?")) return;
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      localStorage.setItem("cadastros_" + usuario.email, "[]");
      mostrar();
    }

    // ===== EXPORTA√á√ÉO =====
    function exportarPDFIndividual(item) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(14);
      doc.text("Registro Individual", 10, 10);
      doc.text(`UUID: ${item.uuid}`, 10, 30);
      doc.text(`Nome: ${item.nome}`, 10, 40);
      doc.text(`Sobrenome: ${item.sobrenome}`, 10, 50);
      doc.text(`Email: ${item.email}`, 10, 60);
      doc.save(`${item.nome || "registro"}.pdf`);
    }

    function exportarPDFGeral() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const lista = JSON.parse(localStorage.getItem("cadastros_" + usuario.email)) || [];
      if (lista.length === 0) return alert("Sem dados!");

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("Relat√≥rio Geral de Cadastros", 10, 10);
      doc.setFontSize(12);
      let y = 30;
      lista.forEach((u, i) => {
        doc.text(`${i + 1}. ${u.nome} ${u.sobrenome} (${u.email})`, 10, y);
        y += 10;
        if (y > 270) { doc.addPage(); y = 20; }
      });
      doc.save("cadastros_geral.pdf");
    }

    // ===== SISTEMA =====
    function mostrarSistema() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      document.getElementById("usuarioAtual").textContent = usuario.nome;
      loginRegistro.classList.add("hidden");
      areaPrincipal.classList.remove("hidden");
      mostrar();
    }

    window.onload = () => {
      const logado = localStorage.getItem("usuarioLogado");
      if (logado) mostrarSistema();
      else mostrarRegistro();
    };
  </script>
</body>
</html>