<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema Local - Visual Premium + PDF Estilizado</title>

  <!-- jsPDF + autotable (para PDF bonito) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: #eef2f7;
      color: #222;
    }
    .container {
      max-width: 980px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #1f4e79;
    }
    input, button {
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-size: 0.95rem;
    }
    input:focus {
      border-color: #1f4e79;
      outline: none;
    }
    button {
      background: #1f4e79;
      color: #fff;
      cursor: pointer;
      border: none;
      transition: 0.3s;
    }
    button:hover {
      background: #2460a0;
    }
    button.warn { background: #d9534f; }
    button.gray { background: #888; }
    button.blue { background: #007bff; }
    button.purple { background: #8e44ad; }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }
    .col {
      flex: 1;
      min-width: 160px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #1f4e79;
      color: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      border-radius: 10px;
      overflow: hidden;
    }
    th {
      background: #1f4e79;
      color: #fff;
      text-align: left;
      padding: 10px;
    }
    td {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    tr:nth-child(even) {
      background: #f9f9f9;
    }
    tr:hover {
      background: #eef3fa;
    }
    td input {
      width: 95%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    @media (max-width: 760px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }
      tr { background: #fff; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
      td { display: flex; justify-content: space-between; padding: 8px; border: none; }
      td::before { content: attr(data-label); font-weight: bold; color: #333; flex: 1; }
      td input { width: 60%; }
    }
    .msg { font-weight: bold; margin-top: 5px; }
  </style>
</head>
<body>

  <!-- LOGIN / REGISTRO -->
  <div class="container" id="authContainer">
    <h2 id="authTitle">Registrar</h2>
    <div id="registerView">
      <div class="row">
        <input id="regNome" placeholder="Nome completo" class="col">
        <input id="regEmail" placeholder="E-mail" class="col" type="email">
      </div>
      <div class="row">
        <input id="regSenha" placeholder="Senha (m√≠n. 4)" type="password" class="col">
        <input id="regSenhaConf" placeholder="Confirmar senha" type="password" class="col">
      </div>
      <div class="row">
        <button onclick="registrar()">Criar conta</button>
        <button class="gray" onclick="mostrarLogin()">J√° tenho conta</button>
      </div>
      <p id="regMsg" class="msg"></p>
    </div>

    <div id="loginView" class="hidden">
      <div class="row">
        <input id="logEmail" placeholder="E-mail" class="col" type="email">
        <input id="logSenha" placeholder="Senha" class="col" type="password">
      </div>
      <div class="row">
        <button onclick="entrar()">Entrar</button>
        <button class="gray" onclick="mostrarRegister()">Ainda n√£o tenho conta</button>
      </div>
      <p id="logMsg" class="msg"></p>
    </div>
  </div>

  <!-- √ÅREA PRINCIPAL -->
  <div class="container hidden" id="mainContainer">
    <div class="topbar">
      <div>üìã Sistema Local</div>
      <div style="display:flex;gap:8px;align-items:center">
        <span id="userBadge"></span>
        <button onclick="sair()">Sair</button>
      </div>
    </div>

    <!-- Formul√°rio -->
    <div class="row" style="margin-top:10px;">
      <input id="cNome" placeholder="Nome">
      <input id="cSobrenome" placeholder="Sobrenome">
      <input id="cEmail" placeholder="Email">
    </div>
    <div class="row">
      <button onclick="adicionarRegistro()">üíæ Salvar</button>
      <button class="warn" onclick="apagarTudo()">üóëÔ∏è Apagar todos</button>
      <button class="blue" onclick="exportarTXT()">üìÑ TXT</button>
      <button class="gray" onclick="exportarExcel()">üìä Excel</button>
      <button class="purple" onclick="exportarPDFGeral()">üìò PDF Geral</button>
    </div>

    <!-- Busca -->
    <div class="row">
      <input id="searchInput" placeholder="Buscar..." oninput="mostrar()">
      <button class="gray" onclick="mostrar(true)">üîÑ Atualizar</button>
    </div>

    <!-- Tabela -->
    <table id="tabela">
      <thead>
        <tr><th>UUID</th><th>Nome</th><th>Sobrenome</th><th>Email</th><th>A√ß√µes</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const { jsPDF } = window.jspdf;
function safeEmailKey(email){ return 'cadastros_' + encodeURIComponent(email.toLowerCase()); }
function gerarUUID(){ return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{const r=Math.random()*16|0,v=c==='x'?r:(r&0x3|0x8);return v.toString(16);}); }

function mostrarLogin(){document.getElementById('authTitle').innerText='Login';document.getElementById('registerView').style.display='none';document.getElementById('loginView').style.display='block';}
function mostrarRegister(){document.getElementById('authTitle').innerText='Registrar';document.getElementById('registerView').style.display='block';document.getElementById('loginView').style.display='none';}

function registrar(){
  const nome=document.getElementById('regNome').value.trim(), email=document.getElementById('regEmail').value.trim().toLowerCase();
  const senha=document.getElementById('regSenha').value, conf=document.getElementById('regSenhaConf').value, msg=document.getElementById('regMsg');
  if(!nome||!email||!senha||!conf) return msg.textContent='Preencha todos!';
  if(senha.length<4) return msg.textContent='Senha curta.';
  if(senha!==conf) return msg.textContent='Senhas diferentes.';
  const users=JSON.parse(localStorage.getItem('usuarios'))||[];
  if(users.find(u=>u.email===email)) return msg.textContent='E-mail j√° cadastrado.';
  users.push({nome,email,senha});localStorage.setItem('usuarios',JSON.stringify(users));
  msg.style.color='green';msg.textContent='Conta criada!';setTimeout(()=>mostrarLogin(),800);
}

function entrar(){
  const email=document.getElementById('logEmail').value.trim().toLowerCase(), senha=document.getElementById('logSenha').value;
  const msg=document.getElementById('logMsg');
  const users=JSON.parse(localStorage.getItem('usuarios'))||[];
  const user=users.find(u=>u.email===email&&u.senha===senha);
  if(!user){msg.textContent='Credenciais inv√°lidas.';return;}
  localStorage.setItem('usuarioLogado',JSON.stringify(user));iniciarSessao();
}

function sair(){localStorage.removeItem('usuarioLogado');document.getElementById('mainContainer').classList.add('hidden');document.getElementById('authContainer').classList.remove('hidden');mostrarLogin();}

function iniciarSessao(){
  const user=JSON.parse(localStorage.getItem('usuarioLogado'));
  if(!user)return;
  document.getElementById('userBadge').textContent=user.nome+' ('+user.email+')';
  document.getElementById('authContainer').classList.add('hidden');
  document.getElementById('mainContainer').classList.remove('hidden');
  mostrar();
}

function carregarLista(){const user=JSON.parse(localStorage.getItem('usuarioLogado'));if(!user)return[];return JSON.parse(localStorage.getItem(safeEmailKey(user.email)))||[];}
function salvarLista(lista){const user=JSON.parse(localStorage.getItem('usuarioLogado'));if(!user)return;localStorage.setItem(safeEmailKey(user.email),JSON.stringify(lista));}

function adicionarRegistro(){
  const n=cNome.value.trim(),s=cSobrenome.value.trim(),e=cEmail.value.trim();
  if(!n||!s||!e)return alert('Preencha tudo!');
  const lista=carregarLista();lista.push({uuid:gerarUUID(),nome:n,sobrenome:s,email:e,criadoEm:new Date().toISOString()});
  salvarLista(lista);cNome.value=cSobrenome.value=cEmail.value='';mostrar();
}

function mostrar(force=false){
  if(force) searchInput.value='';
  const tbody=document.querySelector('#tabela tbody');tbody.innerHTML='';
  const lista=carregarLista();const q=searchInput.value.toLowerCase().trim();
  const filtrada=lista.filter(i=>!q||Object.values(i).join(' ').toLowerCase().includes(q));
  filtrada.forEach(item=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td data-label="UUID">${item.uuid}</td>
      <td data-label="Nome"><input value="${item.nome}" onchange="atualizarCampo('${item.uuid}','nome',this.value)"></td>
      <td data-label="Sobrenome"><input value="${item.sobrenome}" onchange="atualizarCampo('${item.uuid}','sobrenome',this.value)"></td>
      <td data-label="Email"><input value="${item.email}" onchange="atualizarCampo('${item.uuid}','email',this.value)"></td>
      <td data-label="A√ß√µes">
        <button class='purple' onclick='exportarPDFIndividual(${JSON.stringify(item)})'>PDF</button>
        <button class='warn' onclick='apagar("${item.uuid}")'>Apagar</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

function atualizarCampo(uuid,campo,valor){const lista=carregarLista();const item=lista.find(x=>x.uuid===uuid);if(item){item[campo]=valor;salvarLista(lista);}}

function apagar(uuid){if(!confirm('Apagar?'))return;let lista=carregarLista();lista=lista.filter(x=>x.uuid!==uuid);salvarLista(lista);mostrar();}
function apagarTudo(){if(!confirm('Apagar todos?'))return;const user=JSON.parse(localStorage.getItem('usuarioLogado'));localStorage.setItem(safeEmailKey(user.email),JSON.stringify([]));mostrar();}

/* ===== Exporta√ß√µes ===== */
function exportarTXT(){const lista=carregarLista();if(lista.length===0)return alert('Sem dados!');const blob=new Blob([JSON.stringify(lista,null,2)],{type:'text/plain'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='cadastros.txt';a.click();}
function exportarExcel(){const lista=carregarLista();if(lista.length===0)return alert('Sem dados!');let csv='UUID,Nome,Sobrenome,Email\\n';lista.forEach(x=>csv+=`${x.uuid},${x.nome},${x.sobrenome},${x.email}\\n`);const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='cadastros.csv';a.click();}

/* ===== PDF bonito ===== */
function exportarPDFIndividual(item){
  const doc=new jsPDF();
  doc.setFontSize(16);
  doc.setTextColor(31,78,121);
  doc.text('Relat√≥rio Individual',105,20,null,null,'center');
  doc.setFontSize(11);
  doc.text(`Gerado em: ${new Date().toLocaleString()}`,105,30,null,null,'center');
  doc.autoTable({
    startY:50,
    body:[[item.uuid,item.nome,item.sobrenome,item.email,new Date(item.criadoEm).toLocaleString()]],
    head:[['UUID','Nome','Sobrenome','Email','Criado em']],
    styles:{halign:'center',fontSize:10},
    headStyles:{fillColor:[31,78,121]},
  });
  doc.save(`${item.nome||'registro'}.pdf`);
}

function exportarPDFGeral(){
  const lista=carregarLista();if(lista.length===0)return alert('Sem dados!');
  const doc=new jsPDF();
  doc.setFontSize(16);
  doc.setTextColor(31,78,121);
  doc.text('Relat√≥rio Geral de Cadastros',105,20,null,null,'center');
  doc.setFontSize(11);
  doc.text(`Gerado em: ${new Date().toLocaleString()}`,105,30,null,null,'center');
  doc.autoTable({
    startY:50,
    head:[['UUID','Nome','Sobrenome','Email','Criado em']],
    body:lista.map(x=>[x.uuid,x.nome,x.sobrenome,x.email,new Date(x.criadoEm).toLocaleString()]),
    styles:{fontSize:9,halign:'center'},
    headStyles:{fillColor:[31,78,121]},
    alternateRowStyles:{fillColor:[240,244,250]},
  });
  doc.save('cadastros_geral.pdf');
}

/* ===== Inicializa√ß√£o ===== */
window.addEventListener('load',()=>{localStorage.getItem('usuarioLogado')?iniciarSessao():mostrarRegister();});
</script>
</body>
</html>