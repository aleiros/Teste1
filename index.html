<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema Local - Login + Cadastro Avan√ßado</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      color: #333;
    }
    h2 { text-align: center; margin-top: 20px; }

    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    input {
      padding: 8px;
      margin: 6px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px;
      width: 100%;
      margin: 6px 0;
      border: none;
      border-radius: 4px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover { background: #45a049; }

    .hidden { display: none; }

    /* √Årea principal */
    .topbar {
      background: #4CAF50;
      color: white;
      padding: 10px;
      text-align: right;
    }
    .topbar button {
      background: #f44336;
      width: auto;
      padding: 6px 12px;
    }

    /* Tabela */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th { background: #4CAF50; color: white; }
    tr:nth-child(even) { background: #f2f2f2; }
    tr:hover { background: #ddd; }

    td input { width: 90%; padding: 4px; }

    td button {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }
    td button:first-child { background: #2196F3; } /* Alterar */
    td button:last-child { background: #f44336; }  /* Apagar */

    /* Responsividade: vira cards */
    @media (max-width: 720px) {
      table, thead, tbody, th, td, tr { display: block; width: 100%; }
      thead { display: none; }

      tr {
        margin: 0 0 12px 0;
        padding: 10px;
        border-radius: 8px;
        background: #fff;
        box-shadow: 0 1px 6px rgba(0,0,0,0.04);
        border: 1px solid #e6e6e6;
      }

      td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 6px;
        border: none;
        border-bottom: 1px solid #f0f0f0;
        box-sizing: border-box;
      }

      td:last-child { border-bottom: none; }

      td::before {
        content: attr(data-label);
        font-weight: 600;
        margin-right: 10px;
        flex: 0 0 40%;
        white-space: nowrap;
        color: #555;
        font-size: 0.95em;
      }

      td input {
        width: 60%;
        min-width: 120px;
      }

      td:last-child {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        align-items: center;
      }

      .wrap input, .wrap button {
        width: 100%;
        display: block;
        margin: 6px 0;
      }
    }
  </style>
</head>
<body>

  <!-- Login / Registro -->
  <div class="container" id="loginRegistro">
    <h2 id="tituloForm">Registrar</h2>
    <input id="nome" placeholder="Nome completo" class="campo-registro">
    <input id="email" placeholder="Email">
    <input id="senha" placeholder="Senha" type="password">
    <button onclick="registrar()">Criar conta</button>
    <button onclick="mostrarLogin()">J√° tenho conta</button>
  </div>

  <!-- √Årea Principal -->
  <div class="hidden" id="areaPrincipal">
    <div class="topbar">
      <span id="usuarioAtual"></span>
      <button onclick="sair()">Sair</button>
    </div>

    <div class="container wrap">
      <h2>Cadastro Local Avan√ßado</h2>
      <input id="cadNome" placeholder="Nome">
      <input id="cadSobrenome" placeholder="Sobrenome">
      <input id="cadEmail" placeholder="Email">
      <button onclick="salvar()">üíæ Salvar</button>
      <button onclick="apagarTudo()">üóëÔ∏è Apagar todos</button>
      <button onclick="exportarTXT()">üíæ Exportar TXT</button>
      <button onclick="exportarExcel()">üìä Exportar Excel</button>

      <table id="tabela">
        <thead>
          <tr>
            <th>UUID</th>
            <th>Nome</th>
            <th>Sobrenome</th>
            <th>Email</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // LOGIN & REGISTRO
    const loginRegistro = document.getElementById("loginRegistro");
    const areaPrincipal = document.getElementById("areaPrincipal");

    function mostrarLogin() {
      document.getElementById("tituloForm").innerText = "Login";
      document.querySelector(".campo-registro").style.display = "none";
      document.querySelector("button[onclick='registrar()']").innerText = "Entrar";
      document.querySelector("button[onclick='registrar()']").setAttribute("onclick", "login()");
    }

    function mostrarRegistro() {
      document.getElementById("tituloForm").innerText = "Registrar";
      document.querySelector(".campo-registro").style.display = "block";
      document.querySelector("button[onclick='login()']").innerText = "Criar conta";
      document.querySelector("button[onclick='login()']").setAttribute("onclick", "registrar()");
    }

    function registrar() {
      const nome = document.getElementById("nome").value.trim();
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();
      if (!nome || !email || !senha) return alert("Preencha todos os campos!");

      const usuarios = JSON.parse(localStorage.getItem("usuariosLogin")) || [];
      if (usuarios.find(u => u.email === email)) return alert("E-mail j√° registrado.");

      usuarios.push({ nome, email, senha });
      localStorage.setItem("usuariosLogin", JSON.stringify(usuarios));
      alert("Registrado com sucesso!");
      mostrarLogin();
    }

    function login() {
      const email = document.getElementById("email").value.trim();
      const senha = document.getElementById("senha").value.trim();
      const usuarios = JSON.parse(localStorage.getItem("usuariosLogin")) || [];
      const usuario = usuarios.find(u => u.email === email && u.senha === senha);
      if (!usuario) return alert("Credenciais inv√°lidas.");

      localStorage.setItem("usuarioLogado", JSON.stringify(usuario));
      mostrarSistema();
    }

    function sair() {
      localStorage.removeItem("usuarioLogado");
      areaPrincipal.classList.add("hidden");
      loginRegistro.classList.remove("hidden");
      mostrarLogin();
    }

    // CADASTRO LOCAL AVAN√áADO
    function gerarUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function salvar() {
      const nome = document.getElementById("cadNome").value.trim();
      const sobrenome = document.getElementById("cadSobrenome").value.trim();
      const email = document.getElementById("cadEmail").value.trim();
      if (!nome || !sobrenome || !email) return alert("Preencha todos os campos!");

      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;

      let lista = JSON.parse(localStorage.getItem(chave)) || [];
      lista.push({ uuid: gerarUUID(), nome, sobrenome, email });
      localStorage.setItem(chave, JSON.stringify(lista));
      mostrar();

      document.getElementById("cadNome").value = "";
      document.getElementById("cadSobrenome").value = "";
      document.getElementById("cadEmail").value = "";
    }

    function mostrar() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      const lista = JSON.parse(localStorage.getItem(chave)) || [];
      const tbody = document.querySelector("#tabela tbody");
      tbody.innerHTML = "";

      lista.forEach(item => {
        const tr = document.createElement("tr");

        const tdUUID = document.createElement("td");
        tdUUID.textContent = item.uuid;
        tdUUID.setAttribute("data-label", "UUID");
        tr.appendChild(tdUUID);

        const tdNome = document.createElement("td");
        const inputNome = document.createElement("input");
        inputNome.value = item.nome;
        inputNome.onchange = () => atualizarCampo(item.uuid, 'nome', inputNome.value);
        tdNome.appendChild(inputNome);
        tdNome.setAttribute("data-label", "Nome");
        tr.appendChild(tdNome);

        const tdSobrenome = document.createElement("td");
        const inputSob = document.createElement("input");
        inputSob.value = item.sobrenome;
        inputSob.onchange = () => atualizarCampo(item.uuid, 'sobrenome', inputSob.value);
        tdSobrenome.appendChild(inputSob);
        tdSobrenome.setAttribute("data-label", "Sobrenome");
        tr.appendChild(tdSobrenome);

        const tdEmail = document.createElement("td");
        const inputEmail = document.createElement("input");
        inputEmail.value = item.email;
        inputEmail.onchange = () => atualizarCampo(item.uuid, 'email', inputEmail.value);
        tdEmail.appendChild(inputEmail);
        tdEmail.setAttribute("data-label", "Email");
        tr.appendChild(tdEmail);

        const tdAcoes = document.createElement("td");
        tdAcoes.setAttribute("data-label", "A√ß√µes");
        const btnAlt = document.createElement("button");
        btnAlt.textContent = "Alterar";
        btnAlt.onclick = () => atualizarRegistro(item.uuid);
        const btnDel = document.createElement("button");
        btnDel.textContent = "Apagar";
        btnDel.onclick = () => apagar(item.uuid);
        tdAcoes.append(btnAlt, btnDel);
        tr.appendChild(tdAcoes);

        tbody.appendChild(tr);
      });
    }

    function atualizarCampo(uuid, campo, valor) {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      let lista = JSON.parse(localStorage.getItem(chave)) || [];
      const item = lista.find(u => u.uuid === uuid);
      if (!item) return;
      item[campo] = valor;
      localStorage.setItem(chave, JSON.stringify(lista));
    }

    function atualizarRegistro(uuid) {
      alert("Registro atualizado!");
    }

    function apagar(uuid) {
      if (!confirm("Apagar este registro?")) return;
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const chave = "cadastros_" + usuario.email;
      let lista = JSON.parse(localStorage.getItem(chave)) || [];
      lista = lista.filter(item => item.uuid !== uuid);
      localStorage.setItem(chave, JSON.stringify(lista));
      mostrar();
    }

    function apagarTudo() {
      if (!confirm("Apagar todos os registros?")) return;
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      localStorage.setItem("cadastros_" + usuario.email, "[]");
      mostrar();
    }

    function gerarTXT(lista) {
      let conteudo = "UUID\tNome\tSobrenome\tEmail\n";
      lista.forEach(u => {
        conteudo += `${u.uuid}\t${u.nome}\t${u.sobrenome}\t${u.email}\n`;
      });
      return conteudo;
    }

    function exportarTXT() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const lista = JSON.parse(localStorage.getItem("cadastros_" + usuario.email)) || [];
      if (lista.length === 0) return alert("Sem dados!");
      const blob = new Blob([gerarTXT(lista)], { type: "text/plain" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "usuarios.txt";
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function exportarExcel() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      const lista = JSON.parse(localStorage.getItem("cadastros_" + usuario.email)) || [];
      if (lista.length === 0) return alert("Sem dados!");
      let conteudo = "UUID,Nome,Sobrenome,Email\n";
      lista.forEach(u => {
        conteudo += `"${u.uuid}","${u.nome}","${u.sobrenome}","${u.email}"\n`;
      });
      const blob = new Blob([conteudo], { type: "text/csv" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "usuarios.csv";
      a.click();
      URL.revokeObjectURL(a.href);
    }

    // Mostrar sistema ap√≥s login
    function mostrarSistema() {
      const usuario = JSON.parse(localStorage.getItem("usuarioLogado"));
      document.getElementById("usuarioAtual").textContent = usuario.nome;
      loginRegistro.classList.add("hidden");
      areaPrincipal.classList.remove("hidden");
      mostrar();
    }

    window.onload = () => {
      const logado = localStorage.getItem("usuarioLogado");
      if (logado) mostrarSistema();
      else mostrarRegistro();
    };
  </script>
</body>
</html>